<%- include("partials/header.ejs") -%>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<div class="container">

    <div class="card-deck mb-3 text-center">
        <div id="heartRateCard" class="card mb-4 box-shadow">
            <div class="card-header">
                <h4 class="my-0">INFO</h4>
            </div>
            <div class="card-body">
                <ul class="list-unstyled mt-3 mb-4">
                    <li>
                        <h5 class="font-weight-normal" style="text-align: left;">User ID: </h5>
                        <h5 id="userId" style="text-align: right;">10</h5>
                    </li>
                    <li>
                        <h5 class="font-weight-normal" style="text-align: left;">Kiosk ID: </h5>
                        <h5 id="kioskId" style="text-align: right;">10</h5>
                    </li>
                </ul>
                <!-- <button type="button" class="btn btn-lg btn-block btn-outline-primary">Sign up for free</button> -->
            </div>
        </div>
    </div>

    <div class="card-deck mb-3 text-center">
        <div id="heartRateCard" class="card mb-4 box-shadow">
            <div class="card-header">
                <h4 class="my-0">HEART RATE</h4>
            </div>
            <div class="card-body">
                <h1 id="heartRate" class="card-title pricing-card-title heartRate"><%= content.heartRate %> <small
                        class="text-muted">BPM</small></h1>
                <ul class="list-unstyled mt-3 mb-4">
                    <li>Ideally in the range</li>
                    <li>60BPM - 100BPM</li>
                </ul>
                <!-- <button type="button" class="btn btn-lg btn-block btn-outline-primary">Sign up for free</button> -->
            </div>
        </div>
        <div id="temperatureCard" class="card mb-4 box-shadow">
            <div class="card-header">
                <h4 class="my-0">TEMPERATURE</h4>
            </div>
            <div class="card-body">
                <h1 id="temperature" class="card-title pricing-card-title temperature"><%= content.temperature %>
                    <small class="text-muted">ºC</small></h1>
                <ul class="list-unstyled mt-3 mb-4">
                    <li>Ideally in the range</li>
                    <li>36.1ºC - 37.5ºC</li>
                </ul>
                <!-- <button type="button" class="btn btn-lg btn-block btn-primary">Get started</button> -->
            </div>
        </div>
        <div id="spo2Card" class="card mb-4 box-shadow">
            <div class="card-header">
                <h4 class="my-0">BLOOD OXYGEN</h4>
            </div>
            <div class="card-body">
                <h1 id="spo2" class="card-title pricing-card-title spo2"><%= content.spo2 %> <small
                        class="text-muted">%</small>
                </h1>
                <ul class="list-unstyled mt-3 mb-4">
                    <li>Ideally in the range</li>
                    <li>95% - 100%</li>
                </ul>
                <!-- <button type="button" class="btn btn-lg btn-block btn-primary">Contact us</button> -->
            </div>
        </div>
    </div>


    <div class="card-deck mb-3 text-center">
        <div class="card mb-4 box-shadow">
            <div class="card-header">
                <h4 class="my-0">HEART RATE</h4>
            </div>
            <div class="card-body">
                <div class="chart-container">
                    <canvas id="myChart1"></canvas>
                </div>
            </div>
            <!-- <div id="graphs-container" width="600" height="250"> -->
            <!-- Append graph here -->
        </div>
    </div>
    <div class="card-deck mb-3 text-center">
        <div class="card mb-4 box-shadow">
            <div class="card-header">
                <h4 class="my-0">TEMPERATURE</h4>
            </div>
            <div class="card-body">
                <div class="chart-container">
                    <canvas id="myChart2"></canvas>
                </div>
            </div>
        </div>
    </div>
    <div class="card-deck mb-3 text-center">
        <div class="card mb-4 box-shadow">
            <div class="card-header">
                <h4 class="my-0">BLOOD OXYGEN</h4>
            </div>
            <div class="card-body">
                <div class="chart-container">
                    <canvas id="myChart3"></canvas>
                </div>
            </div>
        </div>
    </div>

</div>

<script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
    crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.3.2/chart.min.js"
    integrity="sha512-VCHVc5miKoln972iJPvkQrUYYq7XpxXzvqNfiul1H4aZDwGBGC0lq373KNleaB2LpnC2a/iNfE5zoRYmB4TRDQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="/socket.io/socket.io.js"></script>
<script src="/js/main.js" type="text/javascript"></script>

<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous">
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"
    integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous">
</script>

<!-- <script>

    // var dateArr = [1,2,3,4,5,6,7];
    // var heartRateArr = [1,2,3,4,5,6,7];

//     var content = {
//     heartRate: 0,
//     temperature: 0,
//     spo2: 0,
//     id: 0,
//     };

//     client.on("message", function (topic, message) {
//     // message is Buffer
//     // if (message.toString() === "Hello mqtt") {
//     //     console.log(topic);
//     //     console.log(message.toString());
//     // }

//     if (topic === "/raka") {
//         dataObj = JSON.parse(message.toString());
//         console.log(JSON.parse(message.toString()));
//         content.id = dataObj.id;
//         content.heartRate = dataObj.heartrate;
//         content.spo2 = dataObj.spo2;
//         content.temperature = dataObj.temp;
//         $("#heartRate").html("${dataObj.heartrate}");
//         $("#temperature").html("${dataObj.temperature}");
//         $("#spo2").html("${dataObj.spo2}");
//     }
//     // console.log(content);
// });

    const socket = io();
    var dataObj = {
        id: 0,

    };

    socket.on("mqtt", (message) => {
        console.log("Emit captured by client");
        console.log(message);
        dataObj = message;
        
    })

    console.log("DataOBJ outside socket");
        console.log(dataObj);


    $.getJSON(("http://localhost:3000/api/" + 70), function (data) {
        console.log(data);
        heartRateArr = data.heartRateArr;
        temperatureArr = data.temperatureArr;
        spo2Arr = data.spo2Arr;
        dateArr = data.dateArr;
    

   

    var heartRateCtx = document.getElementById("myChart1").getContext("2d");
    var temperatureCtx = document.getElementById("myChart2").getContext("2d");
    var spo2Ctx = document.getElementById("myChart3").getContext("2d");
    // chart
    heartRateChart = new Chart(heartRateCtx, {
        type: "line",
        data: {
            labels: [dateArr[dateArr.length - 5], dateArr[dateArr.length - 4], dateArr[dateArr.length - 3], dateArr[dateArr.length - 2], dateArr[dateArr.length - 1]],
            datasets: [{
                    label: "impressions",
                    borderColor: "#ff0000",
                    data: [heartRateArr[heartRateArr.length - 5], heartRateArr[heartRateArr.length - 4], heartRateArr[heartRateArr.length - 3], heartRateArr[heartRateArr.length - 2], heartRateArr[heartRateArr.length - 1]],
                },
            ],
        },
    });
    temperatureChart = new Chart(temperatureCtx, {
        type: "line",
        data: {
            labels: [dateArr[dateArr.length - 5], dateArr[dateArr.length - 4], dateArr[dateArr.length - 3], dateArr[dateArr.length - 2], dateArr[dateArr.length - 1]],
            datasets: [{
                    label: "impressions",
                    borderColor: "#f098f9",
                    data: [temperatureArr[temperatureArr.length - 5], temperatureArr[temperatureArr.length - 4], temperatureArr[temperatureArr.length - 3], temperatureArr[temperatureArr.length - 2], temperatureArr[temperatureArr.length - 1]],
                },
            ],
        },
    });
    spo2Chart = new Chart(spo2Ctx, {
        type: "line",
        data: {
            labels: [dateArr[dateArr.length - 5], dateArr[dateArr.length - 4], dateArr[dateArr.length - 3], dateArr[dateArr.length - 2], dateArr[dateArr.length - 1]],
            datasets: [{
                    label: "impressions",
                    borderColor: "#0AFA75",
                    data: [spo2Arr[spo2Arr.length - 5], spo2Arr[spo2Arr.length - 4], spo2Arr[spo2Arr.length - 3], spo2Arr[spo2Arr.length - 2], spo2Arr[spo2Arr.length - 1]],
                },
            ],
        },
    });
    });
</script> -->


<%- include("partials/footer.ejs") -%>